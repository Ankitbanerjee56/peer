<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1"
  />
  <title>PeerJS Mobile Video Call</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PeerJS -->
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

  <!-- Eruda -->
  <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
  <script>eruda.init();</script>
</head>

<body class="bg-gray-900 text-white min-h-screen">

  <div class="min-h-screen flex flex-col p-3 max-w-md mx-auto">

    <!-- Header -->
    <div class="text-center mb-3">
      <h1 class="text-xl font-bold">ðŸ“¹ Video Call</h1>
      <p class="text-gray-400 text-xs">PeerJS Â· Mobile</p>
    </div>

    <!-- My ID -->
    <div class="bg-gray-800 rounded-xl p-3 mb-3">
      <p class="text-xs text-gray-400 mb-1">Your Peer ID</p>
      <div class="flex gap-2 items-center bg-gray-900 rounded-lg p-2">
        <span id="myId" class="text-green-400 text-xs break-all flex-1">
          Connecting...
        </span>
        <button
          onclick="copyId()"
          class="bg-green-600 text-xs px-3 py-2 rounded active:scale-95"
        >
          Copy
        </button>
      </div>
    </div>

    <!-- Call Controls -->
    <div class="bg-gray-800 rounded-xl p-3 mb-3 space-y-2">
      <input
        id="peerIdInput"
        placeholder="Enter peer ID"
        class="w-full p-3 rounded bg-gray-900 text-sm outline-none"
      />
      <button
        onclick="callPeer()"
        class="w-full bg-blue-600 py-3 rounded font-semibold active:scale-95"
      >
        Call
      </button>
      <p id="status" class="text-center text-xs text-gray-400"></p>
    </div>

    <!-- Videos -->
    <div class="flex-1 flex flex-col gap-2 sm:grid sm:grid-cols-2">
      <video
        id="localVideo"
        autoplay
        muted
        playsinline
        class="w-full h-48 sm:h-56 rounded-xl bg-black object-cover"
      ></video>

      <video
        id="remoteVideo"
        autoplay
        playsinline
        class="w-full h-48 sm:h-56 rounded-xl bg-black object-cover"
      ></video>
    </div>

  </div>

  <!-- App Script -->
  <script>
    const localVideo = document.getElementById("localVideo");
    const remoteVideo = document.getElementById("remoteVideo");
    const myIdSpan = document.getElementById("myId");
    const peerIdInput = document.getElementById("peerIdInput");
    const statusText = document.getElementById("status");

    let localStream;

    const peer = new Peer();

    navigator.mediaDevices.getUserMedia({
      video: { facingMode: "user" },
      audio: true
    }).then(stream => {
      localStream = stream;
      localVideo.srcObject = stream;
      statusText.innerText = "Camera & mic ready";
    }).catch(() => {
      statusText.innerText = "Camera permission denied";
    });

    peer.on("open", id => {
      myIdSpan.innerText = id;
    });

    peer.on("call", call => {
      statusText.innerText = "Incoming call...";
      call.answer(localStream);

      call.on("stream", remoteStream => {
        remoteVideo.srcObject = remoteStream;
        statusText.innerText = "Connected";
      });
    });

    function callPeer() {
      const peerId = peerIdInput.value.trim();
      if (!peerId) return alert("Enter peer ID");

      statusText.innerText = "Calling...";
      const call = peer.call(peerId, localStream);

      call.on("stream", remoteStream => {
        remoteVideo.srcObject = remoteStream;
        statusText.innerText = "Connected";
      });
    }

    function copyId() {
      navigator.clipboard.writeText(myIdSpan.innerText);
      statusText.innerText = "Peer ID copied!";
    }
  </script>

</body>
</html>